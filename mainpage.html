<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js" type="module"></script>
        <!-- Firebase Realtime Database -->
        <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js" type= "module"></script>
    <script src="myScript.js" type="module"></script>

    <title>Main page</title>
    <link rel="stylesheet" href="mainpageStyle.css">
</head>
<body>
    <!-- Change mainpage.html to where we need checkbox input to go-->
    <form action="mainpage.html" method="get">
        <div class="imgcontainer">
            <img src="img/SSE_Logo_Practice.png" alt="Logo">
        </div>

        <div class="header">
          <h1>Welcome, reader!</h1>
        </div>
        
        <div class="topnav">
          <a href='README.md'>About Us</a>
          <a href='addbook.html'>Add New Book</a>
          <a href="index.html" style="float:right">Logout</a>
        </div>
      
        <div class="row">
          <div class="leftcolumn">
            <!-- Search bar -->
            <div class="card">
              <input type="text" placeholder="Search..." name="search">
              <button type="submit">Search</button>
            </div>

            <div class="card">
              <h2>Filter</h2>
              <input type="checkbox" name="title"> Title
              <br></br>
              <input type="checkbox" name="author"> Author
              <br></br>
              <input type="checkbox" name="genre"> Genre
              <br></br>
              <input type="checkbox" name="publish_date"> Published Date
              <br></br>
              <button type="applyFilter">Apply Filter</button>
            </div>
          </div>

          <div class="rightcolumn">
            <div class="card">
              <h2>My Library</h2>
              
              </div>
            </div>
          </div>
        </div>
    </form>

    <script>
      // Function to fetch and display books
      function fetchAndDisplayBooks() {
        const bookGrid = document.getElementById('bookGrid');
        if (!bookGrid) {
            console.error('bookGrid element not found!');
            return; // Exit the function if bookGrid is null
        }

        // Get the new book from local storage
        const newBook = JSON.parse(localStorage.getItem('newBook'));
        
        if (newBook) {
            // Add the new book to the grid
            const bookDiv = document.createElement('div');
            bookDiv.classList.add('book');
            bookDiv.innerHTML = `
                <img src="${newBook.image}" alt="${newBook.title}">
                <p>${newBook.title}</p>
            `;
            bookGrid.appendChild(bookDiv);
            
            // Remove the new book from local storage
            localStorage.removeItem('newBook');
        }
    }

    // Call the function initially to load existing books
    fetchAndDisplayBooks();
    setInterval(fetchAndDisplayBooks, 5000);
  </script>

</body>
</html>